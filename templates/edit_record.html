{% extends "base.html" %}
{% block title %}Редагувати запис #{{ r.id }}{% endblock %}
{% block content %}
  <h1>Редагувати запис #{{ r.id }}</h1>
  <form method="post">
    <div class="form-row">
      <label>Дата виписки (DD.MM.YYYY)</label>
      <input name="date_of_discharge" value="{{ r.date_of_discharge.strftime('%d.%m.%Y') if r.date_of_discharge else '' }}" pattern="\d{2}\.\d{2}\.\d{4}" placeholder="DD.MM.YYYY" required>
    </div>
    <div class="form-row">
      <label>ПІБ</label>
      <input name="full_name" value="{{ r.full_name }}" required>
    </div>
    <div class="form-row">
      <label>Відділення</label>
      <input name="discharge_department" value="{{ r.discharge_department or '' }}" required>
    </div>
    <div class="form-row">
      <label>Лікар</label>
      <input name="treating_physician" value="{{ r.treating_physician or '' }}" required>
    </div>
    <div class="form-row">
      <label>Історія</label>
      <textarea name="history" rows="4" required>{{ r.history or '' }}</textarea>
    </div>
    <div class="form-row">
      <label>К днів</label>
      <input name="k_days" type="number" min="0" value="{{ r.k_days or 0 }}" required>
    </div>
    <div class="form-row">
      <label>Статус виписки</label>
      <input name="discharge_status" value="{{ r.discharge_status or '' }}" required>
    </div>
    <div class="form-row">
      <label>Статус</label>
      <input id="status" name="status" value="{{ r.status or '' }}" required>
      <div class="required-note" id="death-note" style="display:none;">Якщо статус — "Помер", вкажіть дату смерті</div>
    </div>
    <div class="form-row">
      <label>Дата смерті (DD.MM.YYYY)</label>
      <input id="date_of_death" name="date_of_death" pattern="\d{2}\.\d{2}\.\d{4}" placeholder="DD.MM.YYYY" value="{{ r.date_of_death.strftime('%d.%m.%Y') if r.date_of_death else '' }}">
    </div>
    <div class="form-row">
      <label>Коментар</label>
      <textarea name="comment" rows="3">{{ r.comment or '' }}</textarea>
    </div>
    <div class="form-actions">
      <button type="submit">Зберегти</button>
      <a href="{{ url_for('index') }}">Скасувати</a>
    </div>
  </form>

  <script>
    (function(){
      var status = document.getElementById('status');
      var death = document.getElementById('date_of_death');
      var note = document.getElementById('death-note');
      function check(){
        if(!status) return;
        var v = status.value && status.value.trim();
        if(v === 'Помер'){
          death.required = true;
          note.style.display = 'block';
        } else {
          death.required = false;
          note.style.display = 'none';
        }
      }
      if(status){ status.addEventListener('input', check); check(); }
    })();
  </script>
{% endblock %}
