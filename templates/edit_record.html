{% extends "base.html" %}
{% block title %}Редагувати запис #{{ r.id }}{% endblock %}
{% block breadcrumbs %}
  <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Записи</a></li>
  <li class="breadcrumb-item active" aria-current="page">Редагувати #{{ r.id }}</li>
{% endblock %}
{% block content %}
  <h1 class="h4">Редагувати запис #{{ r.id }}</h1>
  <form method="post" class="mt-3 row g-2 form-compact">
    <!-- preserve filters so we can return to the filtered list -->
    <input type="hidden" name="filter_discharge_status" value="{{ selected_status }}">
    <input type="hidden" name="filter_treating_physician" value="{{ selected_physician }}">
    <input type="hidden" name="filter_history" value="{{ history_q }}">

    <div class="col-auto">
      <label class="form-label">ПІБ</label>
      <input class="form-control input-name" name="full_name" value="{{ r.full_name }}" maxlength="50" required>
    </div>
    <div class="col-auto">
      <label class="form-label">Дата виписки</label>
      <input class="form-control date-input" name="date_of_discharge" type="date" value="{{ r.date_of_discharge.strftime('%Y-%m-%d') if r.date_of_discharge else '' }}" required>
    </div>
    <div class="col-auto">
      <label class="form-label">К днів</label>
      <input class="form-control input-xsmall" name="k_days" type="number" min="0" value="{{ r.k_days or 0 }}" required>
    </div>
    <div class="col-auto">
      <label class="form-label">Історія</label>
      <input class="form-control input-history" name="history" maxlength="6" value="{{ r.history or '' }}" required>
    </div>
    <div class="col-auto">
      <label class="form-label">Відділення</label>
      <select class="form-select input-medium" name="discharge_department" required>
        <option value="">Оберіть відділення...</option>
        {% for d in departments %}
          <option value="{{ d.name }}" {% if d.name == (r.discharge_department or '') %}selected{% endif %}>{{ d.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <label class="form-label">Лікар</label>
      <input class="form-control input-medium" name="treating_physician" value="{{ r.treating_physician or '' }}" required>
    </div>
    <div class="col-auto">
      <label class="form-label">Статус виписки</label>
      <select class="form-select input-medium" name="discharge_status" required>
        <option value="">Оберіть статус...</option>
        <option value="Виписаний" {% if r.discharge_status == 'Виписаний' %}selected{% endif %}>Виписаний</option>
        <option value="Опрацьовується" {% if r.discharge_status == 'Опрацьовується' %}selected{% endif %}>Опрацьовується</option>
        <option value="Порушені вимоги" {% if r.discharge_status == 'Порушені вимоги' %}selected{% endif %}>Порушені вимоги</option>
        <option value="Помер" {% if r.discharge_status == 'Помер' %}selected{% endif %}>Помер</option>
      </select>
    </div>

    <div class="col-auto" id="death-row">
      <label class="form-label">Дата смерті</label>
      <input id="date_of_death" class="form-control date-input" name="date_of_death" type="date" value="{{ r.date_of_death.strftime('%Y-%m-%d') if r.date_of_death else '' }}">
    </div>
    <div class="col-12">
      <label class="form-label">Коментар</label>
      <textarea class="form-control" name="comment" rows="2">{{ r.comment or '' }}</textarea>
    </div>
    <div class="col-12">
      <button class="btn btn-primary" type="submit">Зберегти</button>
      <a class="btn btn-secondary ms-2" href="{{ url_for('index') }}">Скасувати</a>
    </div>
  </form>
{% endblock %}
