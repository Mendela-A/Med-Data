{% extends "base.html" %}
{% block title %}Додати запис{% endblock %}
{% block content %}
  <h1>Додати запис</h1>
  <form method="post">
    <!-- preserve filters so we can return to the filtered list -->
    <input type="hidden" name="discharge_status" value="{{ selected_status }}">
    <input type="hidden" name="treating_physician" value="{{ selected_physician }}">
    <input type="hidden" name="history" value="{{ history_q }}">

    <div class="form-row">
      <label>Дата виписки (DD.MM.YYYY)</label>
      <input name="date_of_discharge" pattern="\d{2}\.\d{2}\.\d{4}" placeholder="DD.MM.YYYY" required>
    </div>
    <div class="form-row">
      <label>ПІБ</label>
      <input name="full_name" required>
    </div>
    <div class="form-row">
      <label>Відділення</label>
      <input name="discharge_department" required>
    </div>
    <div class="form-row">
      <label>Лікар</label>
      <input name="treating_physician" required>
    </div>
    <div class="form-row">
      <label>Історія</label>
      <textarea name="history" rows="4" required></textarea>
    </div>
    <div class="form-row">
      <label>К днів</label>
      <input name="k_days" type="number" min="0" required>
    </div>
    <div class="form-row">
      <label>Статус виписки / статус</label>
      <input id="status" name="status" required>
      <div class="required-note" id="death-note" style="display:none;">Якщо статус — "Помер", вкажіть дату смерті</div>
    </div>
    <div class="form-row">
      <label>Дата смерті (DD.MM.YYYY)</label>
      <input id="date_of_death" name="date_of_death" pattern="\d{2}\.\d{2}\.\d{4}" placeholder="DD.MM.YYYY">
    </div>
    <div class="form-actions">
      <button type="submit">Додати</button>
    </div>
    <script>
      (function(){
        var status = document.getElementById('status');
        var death = document.getElementById('date_of_death');
        var note = document.getElementById('death-note');
        function check(){
          if(!status) return;
          var v = status.value && status.value.trim();
          if(v === 'Помер'){
            death.required = true;
            note.style.display = 'block';
          } else {
            death.required = false;
            note.style.display = 'none';
          }
        }
        if(status){ status.addEventListener('input', check); check(); }
      })();
    </script>
  </form>
{% endblock %}
