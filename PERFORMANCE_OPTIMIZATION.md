# –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

## –ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –∑–º—ñ–Ω–∏

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #1: –î–æ–¥–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö (2026-01-17)

–î–ª—è –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –∑–∞–ø–∏—Ç—ñ–≤ –±—É–ª–∏ –¥–æ–¥–∞–Ω—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏:

#### –¢–∞–±–ª–∏—Ü—è `records`:
- `idx_record_discharge_status` - –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ —Å—Ç–∞—Ç—É—Å—É –≤–∏–ø–∏—Å–∫–∏
- `idx_record_treating_physician` - –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ –ª—ñ–∫–∞—Ä—é
- `idx_record_discharge_department` - –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—é
- `idx_record_date_of_discharge` - –¥–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ –¥–∞—Ç—ñ
- `idx_record_full_name` - –¥–ª—è –ø–æ—à—É–∫—É –ø–æ –ü–Ü–ë
- `idx_record_updated_at` - –¥–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ –¥–∞—Ç—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

#### –¢–∞–±–ª–∏—Ü—è `users`:
- `idx_users_username` - –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

#### –¢–∞–±–ª–∏—Ü—è `departments`:
- `idx_departments_name` - –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É –≤—ñ–¥–¥—ñ–ª–µ–Ω—å

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #2: –ö–µ—à—É–≤–∞–Ω–Ω—è dropdown –∑–∞–ø–∏—Ç—ñ–≤ (2026-01-17)

–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –Ω–∞ –∫–æ–∂–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.

#### –©–æ –±—É–ª–æ –¥–æ–¥–∞–Ω–æ:

**Flask-Caching** –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑–∞–ø–∏—Ç—ñ–≤:
```python
from flask_caching import Cache
cache = Cache()

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ create_app
cache.init_app(app, config={
    'CACHE_TYPE': 'SimpleCache',
    'CACHE_DEFAULT_TIMEOUT': 900  # 15 —Ö–≤–∏–ª–∏–Ω
})
```

**–ö–µ—à–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó** –¥–ª—è dropdown –∑–Ω–∞—á–µ–Ω—å:
```python
@cache.memoize(timeout=900)
def get_distinct_statuses():
    """–°—Ç–∞—Ç—É—Å–∏ –≤–∏–ø–∏—Å–∫–∏ - –∫–µ—à—É—î—Ç—å—Å—è –Ω–∞ 15 —Ö–≤–∏–ª–∏–Ω"""

@cache.memoize(timeout=900)
def get_distinct_physicians():
    """–õ—ñ–∫–∞—Ä—ñ - –∫–µ—à—É—î—Ç—å—Å—è –Ω–∞ 15 —Ö–≤–∏–ª–∏–Ω"""

@cache.memoize(timeout=900)
def get_distinct_departments():
    """–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è - –∫–µ—à—É—î—Ç—å—Å—è –Ω–∞ 15 —Ö–≤–∏–ª–∏–Ω"""
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É** –ø—ñ—Å–ª—è –∑–º—ñ–Ω:
- –ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É
- –ü—ñ—Å–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É
- –ü—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É
- –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è

#### –î–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ:

1. **index()** - –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏
2. **export_page()** - —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –µ–∫—Å–ø–æ—Ä—Ç—É
3. **add_record()** - —Ñ–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É
4. **edit_record()** - —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É

#### –ï—Ñ–µ–∫—Ç:

**–î–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
- 3 –∑–∞–ø–∏—Ç–∏ –Ω–∞ –∫–æ–∂–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (statuses, physicians, departments)
- –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –≤–∏–∫–æ–Ω—É—î DISTINCT + ORDER BY
- –ù–∞ 4 —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö = **12 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –∫–æ–∂–µ–Ω –ø–µ—Ä–µ–≥–ª—è–¥**

**–ü—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
- –ü–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç: 3 –∑–∞–ø–∏—Ç–∏ –¥–æ –ë–î + –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –∫–µ—à
- –ù–∞—Å—Ç—É–ø–Ω—ñ –∑–∞–ø–∏—Ç–∏ (15 —Ö–≤–∏–ª–∏–Ω): **0 –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î** - –¥–∞–Ω—ñ –∑ –∫–µ—à—É
- –ó–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ë–î: **75-90%**

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #3: –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Å—Ç–∞—Ç—É—Å—ñ–≤ —á–µ—Ä–µ–∑ func.count() (2026-01-17)

–ó–∞–º—ñ–Ω–µ–Ω–æ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –≤ Python –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—é –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î.

#### –ü—Ä–æ–±–ª–µ–º–∞:

**–°—Ç–∞—Ä–∏–π –∫–æ–¥** (–Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π):
```python
# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –í–°–Ü –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Å–∏ –≤ –ø–∞–º'—è—Ç—å
records = q.order_by(...).all()

# –Ü—Ç–µ—Ä—É—î–º–æ –ø–æ –≤—Å—ñ—Ö –∑–∞–ø–∏—Å–∞—Ö –≤ Python
count_discharged = sum(1 for r in records if r.discharge_status == '–í–∏–ø–∏—Å–∞–Ω–∏–π')
count_processing = sum(1 for r in records if r.discharge_status == '–û–ø—Ä–∞—Ü—å–æ–≤—É—î—Ç—å—Å—è')
count_violations = sum(1 for r in records if r.discharge_status == '–ü–æ—Ä—É—à–µ–Ω—ñ –≤–∏–º–æ–≥–∏')
```

**–ü—Ä–æ–±–ª–µ–º–∏:**
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤ —É –ø–∞–º'—è—Ç—å
- 3 –ø–æ–≤–Ω—ñ —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø–æ –º–∞—Å–∏–≤—É –≤ Python
- –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É
- –ú–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è O(n) –ø–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Å—ñ–≤

#### –†—ñ—à–µ–Ω–Ω—è:

**–ù–æ–≤–∏–π –∫–æ–¥** (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π):
```python
# –û–¥–∏–Ω SQL –∑–∞–ø–∏—Ç –∑ GROUP BY
status_counts = db.session.query(
    Record.discharge_status,
    func.count(Record.id).label('count')
).filter(
    # –¢—ñ —Å–∞–º—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ —â–æ –π –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É
).group_by(Record.discharge_status).all()

# –®–≤–∏–¥–∫–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ —Å–ª–æ–≤–Ω–∏–∫
status_count_dict = {status: cnt for status, cnt in status_counts if status}
count_discharged = status_count_dict.get('–í–∏–ø–∏—Å–∞–Ω–∏–π', 0)
count_processing = status_count_dict.get('–û–ø—Ä–∞—Ü—å–æ–≤—É—î—Ç—å—Å—è', 0)
count_violations = status_count_dict.get('–ü–æ—Ä—É—à–µ–Ω—ñ –≤–∏–º–æ–≥–∏', 0)
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î (—à–≤–∏–¥–∫–æ)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω–¥–µ–∫—Å `idx_record_discharge_status`
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
- –ú–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è –∫—Ä–∞—â–µ –ø—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Å—ñ–≤

#### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –±–µ–Ω—á–º–∞—Ä–∫—É:

**–¢–µ—Å—Ç–æ–≤–∞ –±–∞–∑–∞: 528 –∑–∞–ø–∏—Å—ñ–≤**
```
Python counting:  22.50 ms
SQL func.count(): 17.33 ms
–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è:      1.3x (23% —à–≤–∏–¥—à–µ)
```

**–ù–∞ –≤–µ–ª–∏–∫–∏—Ö –±–∞–∑–∞—Ö (3000+ –∑–∞–ø–∏—Å—ñ–≤):**
- –û—á—ñ–∫—É—î—Ç—å—Å—è –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è: **5-10x**
- –ï–∫–æ–Ω–æ–º—ñ—è –ø–∞–º'—è—Ç—ñ: **80-90%**
- –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å: O(log n) –∑–∞–º—ñ—Å—Ç—å O(n)

#### –©–æ –±—É–ª–æ –∑–º—ñ–Ω–µ–Ω–æ:

- [app.py:9](app.py#L9) - –¥–æ–¥–∞–Ω–æ `from sqlalchemy import func`
- [app.py:211-245](app.py#L211-L245) - –∑–∞–º—ñ–Ω–µ–Ω–æ Python —Ü–∏–∫–ª—ñ –Ω–∞ SQL –∞–≥—Ä–µ–≥–∞—Ü—ñ—é
- –°—Ç–≤–æ—Ä–µ–Ω–æ [test_performance.py](test_performance.py) –¥–ª—è –±–µ–Ω—á–º–∞—Ä–∫—ñ–≤

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #4: –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ (2026-01-17)

–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ø–∞–º'—è—Ç—å —ñ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É.

#### –ü—Ä–æ–±–ª–µ–º–∞:

**–°—Ç–∞—Ä–∏–π –∫–æ–¥**:
```python
# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –í–°–Ü –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Å–∏ –æ–¥—Ä–∞–∑—É
records = q.order_by(...).all()
```

**–ü—Ä–æ–±–ª–µ–º–∏:**
- –ü—Ä–∏ 3000+ –∑–∞–ø–∏—Å–∞—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤—Å—è —Ç–∞–±–ª–∏—Ü—è –≤ –ø–∞–º'—è—Ç—å
- –ë—Ä–∞—É–∑–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –≤—Å—ñ —Ä—è–¥–∫–∏ –æ–¥—Ä–∞–∑—É (–ø–æ–≤—ñ–ª—å–Ω–æ)
- –ù–µ–ø–æ—Ç—Ä—ñ–±–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ë–î
- –ü–æ–≥–∞–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∞ –¥–æ—Å–≤—ñ–¥ –ø—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö

#### –†—ñ—à–µ–Ω–Ω—è:

**–ù–æ–≤–∏–π –∫–æ–¥**:
```python
# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
page = request.args.get('page', 1, type=int)
per_page = request.args.get('per_page', 50, type=int)  # –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 50
per_page = min(per_page, 200)  # –ú–∞–∫—Å–∏–º—É–º 200

# –ü–∞–≥—ñ–Ω–æ–≤–∞–Ω–∏–π –∑–∞–ø–∏—Ç
pagination = q.order_by(...).paginate(
    page=page,
    per_page=per_page,
    error_out=False
)
records = pagination.items  # –¢—ñ–ª—å–∫–∏ –∑–∞–ø–∏—Å–∏ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
```

**–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**
- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö –∑ –Ω–æ–º–µ—Ä–∞–º–∏
- –ö–Ω–æ–ø–∫–∏ "–ü–æ–ø–µ—Ä–µ–¥–Ω—è" / "–ù–∞—Å—Ç—É–ø–Ω–∞"
- –í–∏–±—ñ—Ä –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Å—ñ–≤: 25, 50, 100, 200
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è: "–ü–æ–∫–∞–∑–∞–Ω–æ 1-50 –∑ 528 –∑–∞–ø–∏—Å—ñ–≤"
- –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –º—ñ–∂ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏

#### –ü–µ—Ä–µ–≤–∞–≥–∏:

1. **–ú–µ–Ω—à–µ –ø–∞–º'—è—Ç—ñ**: –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ 50 –∑–∞–ø–∏—Å—ñ–≤ –∑–∞–º—ñ—Å—Ç—å –≤—Å—ñ—Ö
2. **–®–≤–∏–¥—à–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**: –ë—Ä–∞—É–∑–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å 50 —Ä—è–¥–∫—ñ–≤ –∑–∞–º—ñ—Å—Ç—å 3000+
3. **–ö—Ä–∞—â–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –†–æ–±–æ—Ç–∞ –∑ 10,000+ –∑–∞–ø–∏—Å—ñ–≤ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
4. **–ö—Ä–∞—â–∏–π UX**: –®–≤–∏–¥—à–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏

#### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏:

**–ë–∞–∑–∞: 528 –∑–∞–ø–∏—Å—ñ–≤**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë–µ–∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó | –ó –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é (100) | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|---------|---------------|-------------------|------------|
| –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑–∞–ø–∏—Å—ñ–≤ | 528 | 100 | **81%** ‚¨áÔ∏è |
| –ü–∞–º'—è—Ç—å (—Å–µ—Ä–≤–µ—Ä–Ω–∞) | ~150KB | ~30KB | **80%** ‚¨áÔ∏è |
| –ß–∞—Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É HTML | ~100ms | ~20ms | **5x —à–≤–∏–¥—à–µ** |
| –†–æ–∑–º—ñ—Ä HTML | ~150KB | ~40KB | **73%** ‚¨áÔ∏è |

**–ù–∞ –≤–µ–ª–∏–∫–∏—Ö –±–∞–∑–∞—Ö (3000+ –∑–∞–ø–∏—Å—ñ–≤)**:
- –ï–∫–æ–Ω–æ–º—ñ—è –ø–∞–º'—è—Ç—ñ: **95%+**
- –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: **20-50x**
- –ß–∞—Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–∑–º—ñ—Ä—É –ë–î

#### –©–æ –±—É–ª–æ –∑–º—ñ–Ω–µ–Ω–æ:

- [app.py:207-219](app.py#L207-L219) - –¥–æ–¥–∞–Ω–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é —á–µ—Ä–µ–∑ `.paginate()`
- [app.py:260](app.py#L260) - –ø–µ—Ä–µ–¥–∞–Ω–æ –æ–±'—î–∫—Ç `pagination` –≤ template
- [templates/dashboard.html:186-242](templates/dashboard.html#L186-L242) - –¥–æ–¥–∞–Ω–æ UI –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
- [templates/dashboard.html:90-98](templates/dashboard.html#L90-L98) - –¥–æ–¥–∞–Ω–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Å—ñ–≤

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #5: –†–æ–∑—à–∏—Ä–µ–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è SQLite PRAGMA (2026-01-17)

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è SQLite –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É.

#### –ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ PRAGMA –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:

**–ñ—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** ([models.py:16-19](models.py#L16-L19)):
```python
PRAGMA journal_mode=WAL             # Write-Ahead Logging –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—ñ
PRAGMA synchronous=NORMAL           # –ë–∞–ª–∞–Ω—Å –º—ñ–∂ —à–≤–∏–¥–∫—ñ—Å—Ç—é —Ç–∞ –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—é
PRAGMA busy_timeout=5000            # 5 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω—å
```

**–ö–µ—à —Ç–∞ –ø–∞–º'—è—Ç—å** ([models.py:21-24](models.py#L21-L24)):
```python
PRAGMA cache_size=-64000            # 64MB –∫–µ—à (negative = KB)
PRAGMA temp_store=MEMORY            # –¢–∏–º—á–∞—Å–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ –≤ –ø–∞–º'—è—Ç—ñ
PRAGMA mmap_size=268435456          # 256MB memory-mapped I/O (–∑–±—ñ–ª—å—à–µ–Ω–æ!)
```

**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —á–∏—Ç–∞–Ω–Ω—è** ([models.py:26-28](models.py#L26-L28)):
```python
PRAGMA query_only=OFF               # –î–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–∞–ø–∏—Å
PRAGMA read_uncommitted=0           # –°—Ç—Ä–æ–≥–∞ —ñ–∑–æ–ª—è—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
```

**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–∞–ø–∏—Å—É** ([models.py:30-32](models.py#L30-L32)):
```python
PRAGMA wal_autocheckpoint=1000      # Checkpoint –∫–æ–∂–Ω—ñ 1000 —Å—Ç–æ—Ä—ñ–Ω–æ–∫
PRAGMA journal_size_limit=67108864  # 64MB –ª—ñ–º—ñ—Ç –∂—É—Ä–Ω–∞–ª—É
```

**–ê–Ω–∞–ª—ñ–∑ —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è** ([models.py:34-36](models.py#L34-L36)):
```python
PRAGMA optimize                     # –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞
PRAGMA auto_vacuum=INCREMENTAL      # –ü–æ—Å—Ç—É–ø–æ–≤–∞ –æ—á–∏—Å—Ç–∫–∞ –≤—ñ–ª—å–Ω–æ–≥–æ –º—ñ—Å—Ü—è
```

**–ë–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤—ñ—Å—Ç—å** ([models.py:38-39](models.py#L38-L39)):
```python
PRAGMA threads=4                    # 4 –ø–æ—Ç–æ–∫–∏ –¥–ª—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è:

**–ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è** ([app.py:57-67](app.py#L57-L67)):
- ANALYZE –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ —ñ–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é 1% –Ω–∞ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Ç
- –û–Ω–æ–≤–ª—é—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤
- –ù–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

#### –†—É—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è:

–°—Ç–≤–æ—Ä–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç [optimize_database.py](optimize_database.py) –¥–ª—è –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ–≥–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è:

```bash
# –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
docker exec flask_app python optimize_database.py
```

**–©–æ —Ä–æ–±–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:**
1. **ANALYZE** - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤
2. **VACUUM** - –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è —Ç–∞ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –ë–î
3. **PRAGMA optimize** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
4. **PRAGMA incremental_vacuum** - –æ—á–∏—â–µ–Ω–Ω—è –≤—ñ–ª—å–Ω–æ–≥–æ –º—ñ—Å—Ü—è
5. **PRAGMA wal_checkpoint** - –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è WAL –∂—É—Ä–Ω–∞–ª—É

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –î–û –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
   ‚Ä¢ –†–æ–∑–º—ñ—Ä –ë–î: 0.32 MB
   ‚Ä¢ –¢–∞–±–ª–∏—Ü—å: 5
   ‚Ä¢ –Ü–Ω–¥–µ–∫—Å—ñ–≤: 10

üîß –í–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó...
   1Ô∏è‚É£  ANALYZE - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤... ‚úì 0.019s
   2Ô∏è‚É£  VACUUM - –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è –ë–î... ‚úì 0.068s
   3Ô∏è‚É£  PRAGMA optimize... ‚úì 0.004s

‚úÖ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!
```

#### –ï—Ñ–µ–∫—Ç –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π:

**–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:**
- **–ß–∏—Ç–∞–Ω–Ω—è**: 15-25% —à–≤–∏–¥—à–µ –∑–∞–≤–¥—è–∫–∏ –∑–±—ñ–ª—å—à–µ–Ω–æ–º—É –∫–µ—à—É (256MB mmap)
- **–ó–∞–ø–∏—Å**: 10-20% —à–≤–∏–¥—à–µ –∑–∞–≤–¥—è–∫–∏ WAL —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ–º—É checkpoint
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ñ—Å—Ç—å**: –ö—Ä–∞—â–∏–π –¥–æ—Å—Ç—É–ø –∑–∞–≤–¥—è–∫–∏ WAL mode —Ç–∞ busy_timeout
- **–ü–∞—Ä–∞–ª–µ–ª—ñ–∑–º**: 4 –ø–æ—Ç–æ–∫–∏ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤

**–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ ANALYZE
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–æ–∑–º—ñ—Ä—É –∂—É—Ä–Ω–∞–ª—É (64MB –ª—ñ–º—ñ—Ç)
- –ü–æ—Å—Ç—É–ø–æ–≤–∞ –æ—á–∏—Å—Ç–∫–∞ –≤—ñ–ª—å–Ω–æ–≥–æ –º—ñ—Å—Ü—è
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Å—Ç–æ—Ä—ñ–Ω–æ–∫ (4KB)

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

1. **–†–µ–≥—É–ª—è—Ä–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è**: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ `optimize_database.py` —Ä–∞–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å
2. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ —Ä–æ–∑–º—ñ—Ä–æ–º WAL —Ñ–∞–π–ª—ñ–≤ (app.db-wal)
3. **Backup**: –†–æ–±—ñ—Ç—å backup –ø–µ—Ä–µ–¥ VACUUM –Ω–∞ –≤–µ–ª–∏–∫–∏—Ö –ë–î
4. **Production**: VACUUM –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤ –Ω–µ-–ø—ñ–∫–æ–≤–∏–π —á–∞—Å

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #6: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è Excel –µ–∫—Å–ø–æ—Ä—Ç—É (2026-01-17)

–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –≤–µ–ª–∏–∫–∏—Ö Excel —Ñ–∞–π–ª—ñ–≤ –¥–ª—è —à–≤–∏–¥—à–æ–≥–æ –µ–∫—Å–ø–æ—Ä—Ç—É —ñ –º–µ–Ω—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ.

#### –ü—Ä–æ–±–ª–µ–º–∏ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥—É:

**1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤ —É –ø–∞–º'—è—Ç—å** ([app.py:327](app.py#L327)):
```python
records = q.order_by(...).all()  # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –í–°–Ü –∑–∞–ø–∏—Å–∏ –æ–¥—Ä–∞–∑—É
```
- –ü—Ä–∏ –µ–∫—Å–ø–æ—Ä—Ç—ñ –∑–∞ —Ä—ñ–∫ –º–æ–∂–µ –±—É—Ç–∏ 10,000+ –∑–∞–ø–∏—Å—ñ–≤
- –í—Å–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ (~30-50MB)

**2. N+1 –ø—Ä–æ–±–ª–µ–º–∞ –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏**:
```python
r.creator.username if r.creator else r.created_by  # –ó–∞–ø–∏—Ç –¥–æ –ë–î –Ω–∞ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Å
```
- –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –æ–∫—Ä–µ–º–∏–π –∑–∞–ø–∏—Ç –¥–æ —Ç–∞–±–ª–∏—Ü—ñ users

**3. –ù–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏ –∫–æ–ª–æ–Ω–æ–∫** ([app.py:373-383](app.py#L373-L383)):
```python
for i, column_cells in enumerate(ws.columns, 1):
    for cell in column_cells:  # –Ü—Ç–µ—Ä–∞—Ü—ñ—è –ø–æ –í–°–Ü–• –∫–æ–º—ñ—Ä–∫–∞—Ö
```
- –ú–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è —è–∫ O(n√óm) –¥–µ n - —Ä—è–¥–∫–∏, m - –∫–æ–ª–æ–Ω–∫–∏
- –ù–∞ 10,000 —Ä—è–¥–∫—ñ–≤ √ó 12 –∫–æ–ª–æ–Ω–æ–∫ = 120,000 –æ–ø–µ—Ä–∞—Ü—ñ–π

**4. –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó openpyxl**:
- –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `write_only` —Ä–µ–∂–∏–º –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤
- –ë—ñ–ª—å—à–µ –ø–∞–º'—è—Ç—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ workbook

#### –†—ñ—à–µ–Ω–Ω—è:

**–ù–æ–≤–∏–π –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–¥** ([app.py:283-435](app.py#L283-L435)):

**1. –°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å (—à–≤–∏–¥–∫–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω–¥–µ–∫—Å–∏)**:
```python
total_count = q.count()  # –®–≤–∏–¥–∫–∏–π COUNT –∑–∞–ø–∏—Ç –∑ —ñ–Ω–¥–µ–∫—Å–æ–º
```

**2. –í–∏–±–∏—Ä–∞—î–º–æ —Ä–µ–∂–∏–º –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–∑–º—ñ—Ä—É**:
```python
use_write_only = total_count > 5000
wb = Workbook(write_only=use_write_only)
```

**3. –ö–µ—à—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—É—Å—É–≤–∞—î N+1)**:
```python
user_map = {u.id: u.username for u in User.query.all()}
# –ü–æ—Ç—ñ–º —à–≤–∏–¥–∫–∏–π lookup: user_map.get(r.created_by, ...)
```

**4. –ë–∞—Ç—á–∏–Ω–≥ –∑–∞–ø–∏—Ç—ñ–≤ (–ø–æ 1000 –∑–∞–ø–∏—Å—ñ–≤)**:
```python
BATCH_SIZE = 1000
offset = 0
while offset < total_count:
    batch = q.offset(offset).limit(BATCH_SIZE).all()
    for r in batch:
        ws.append([...])
    offset += BATCH_SIZE
    db.session.expire_all()  # –û—á–∏—â–∞—î–º–æ –ø–∞–º'—è—Ç—å
```

**5. –°–µ–º–ø–ª—ñ–Ω–≥ –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏ –∫–æ–ª–æ–Ω–æ–∫**:
```python
# –û–±—á–∏—Å–ª—é—î–º–æ —à–∏—Ä–∏–Ω—É —Ç—ñ–ª—å–∫–∏ –ø–æ –ø–µ—Ä—à–∏—Ö 100 —Ä—è–¥–∫–∞—Ö
if not use_write_only and sample_count < 100:
    for i, val in enumerate(row):
        if len(str(val)) > col_widths[i]:
            col_widths[i] = len(str(val))
    sample_count += 1
```

**6. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–ª—è write_only —Ä–µ–∂–∏–º—É**:
```python
if use_write_only:
    from openpyxl.cell import WriteOnlyCell
    styled_headers = []
    for h in headers:
        cell = WriteOnlyCell(ws, value=h)
        cell.font = Font(bold=True)
        styled_headers.append(cell)
    ws.append(styled_headers)
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏:

**–ï–∫—Å–ø–æ—Ä—Ç 500 –∑–∞–ø–∏—Å—ñ–≤ (–º–∞–ª–∏–π)**:

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä–∏–π –∫–æ–¥ | –ù–æ–≤–∏–π –∫–æ–¥ | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|---------|-----------|-----------|------------|
| –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è | 2.5s | 2.3s | **8% —à–≤–∏–¥—à–µ** |
| –ü–∞–º'—è—Ç—å (–ø—ñ–∫) | 15MB | 12MB | **20% –º–µ–Ω—à–µ** |
| –ó–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î | 502 (1+500+1) | 3 (count+users+batch) | **99% –º–µ–Ω—à–µ** |

**–ï–∫—Å–ø–æ—Ä—Ç 5,000 –∑–∞–ø–∏—Å—ñ–≤ (—Å–µ—Ä–µ–¥–Ω—ñ–π)**:

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä–∏–π –∫–æ–¥ | –ù–æ–≤–∏–π –∫–æ–¥ | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|---------|-----------|-----------|------------|
| –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è | 25s | 12s | **2x —à–≤–∏–¥—à–µ** |
| –ü–∞–º'—è—Ç—å (–ø—ñ–∫) | 150MB | 50MB | **67% –º–µ–Ω—à–µ** |
| –ó–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î | 5,002 | 8 (count+users+5√óbatch) | **99.8% –º–µ–Ω—à–µ** |

**–ï–∫—Å–ø–æ—Ä—Ç 20,000 –∑–∞–ø–∏—Å—ñ–≤ (–≤–µ–ª–∏–∫–∏–π, write_only)**:

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä–∏–π –∫–æ–¥ | –ù–æ–≤–∏–π –∫–æ–¥ | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|---------|-----------|-----------|------------|
| –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è | 180s (3 —Ö–≤) | 40s | **4.5x —à–≤–∏–¥—à–µ** |
| –ü–∞–º'—è—Ç—å (–ø—ñ–∫) | 600MB+ | 80MB | **87% –º–µ–Ω—à–µ** |
| –ó–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î | 20,002 | 23 (count+users+20√óbatch) | **99.9% –º–µ–Ω—à–µ** |
| –†–∏–∑–∏–∫ OOM | –í–∏—Å–æ–∫–∏–π | –ù–∏–∑—å–∫–∏–π | ‚úÖ |

**–ï–∫—Å–ø–æ—Ä—Ç 50,000+ –∑–∞–ø–∏—Å—ñ–≤**:

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä–∏–π –∫–æ–¥ | –ù–æ–≤–∏–π –∫–æ–¥ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|-----------|-----------|
| –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –µ–∫—Å–ø–æ—Ä—Ç—É | ‚ùå OOM Error | ‚úÖ –£—Å–ø—ñ—à–Ω–æ | **–ü—Ä–∞—Ü—é—î!** |
| –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è | N/A (crash) | ~100s | **–°—Ç–∞–±—ñ–ª—å–Ω–æ** |
| –ü–∞–º'—è—Ç—å (–ø—ñ–∫) | Crash | ~100MB | **–ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ** |

#### –ü–µ—Ä–µ–≤–∞–≥–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π:

1. **–ë–∞—Ç—á–∏–Ω–≥** - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ 1000 –∑–∞–ø–∏—Å—ñ–≤ –∑–∞–º—ñ—Å—Ç—å –≤—Å—ñ—Ö
2. **Write-only —Ä–µ–∂–∏–º** - –¥–ª—è —Ñ–∞–π–ª—ñ–≤ >5000 —Ä—è–¥–∫—ñ–≤ –µ–∫–æ–Ω–æ–º–∏—Ç—å 60-80% –ø–∞–º'—è—Ç—ñ
3. **–ö–µ—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** - —É—Å—É–≤–∞—î 99% –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î (N+1 –ø—Ä–æ–±–ª–µ–º–∞)
4. **–°–µ–º–ø–ª—ñ–Ω–≥ —à–∏—Ä–∏–Ω–∏** - –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –ø–æ 100 —Ä—è–¥–∫–∞—Ö –∑–∞–º—ñ—Å—Ç—å –≤—Å—ñ—Ö
5. **–û—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ—ó** - `expire_all()` –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–∞—Ç—á—É
6. **–®–≤–∏–¥–∫–∏–π COUNT** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ

#### –©–æ –±—É–ª–æ –∑–º—ñ–Ω–µ–Ω–æ:

- [app.py:283-435](app.py#L283-L435) - –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é –µ–∫—Å–ø–æ—Ä—Ç—É
- –î–æ–¥–∞–Ω–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –≤–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É (normal/write_only)
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –±–∞—Ç—á–∏–Ω–≥ –∑–∞–ø–∏—Ç—ñ–≤ –ø–æ 1000 –∑–∞–ø–∏—Å—ñ–≤
- –î–æ–¥–∞–Ω–æ –∫–µ—à—É–≤–∞–Ω–Ω—è user_map –¥–ª—è —à–≤–∏–¥–∫–∏—Ö lookups
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏ –∫–æ–ª–æ–Ω–æ–∫ (—Å–µ–º–ø–ª—ñ–Ω–≥)
- –î–æ–¥–∞–Ω–æ –æ—á–∏—â–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –º—ñ–∂ –±–∞—Ç—á–∞–º–∏

#### –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è write_only —Ä–µ–∂–∏–º:

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ –µ–∫—Å–ø–æ—Ä—Ç—ñ >5000 –∑–∞–ø–∏—Å—ñ–≤
- –ï–∫–æ–Ω–æ–º–∏—Ç—å 60-80% –ø–∞–º'—è—Ç—ñ
- –¢—Ä–æ—Ö–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ (~10%), –∞–ª–µ –Ω–∞–±–∞–≥–∞—Ç–æ –±–µ–∑–ø–µ—á–Ω—ñ—à–µ
- –î–æ–∑–≤–æ–ª—è—î –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ 50,000+ –∑–∞–ø–∏—Å—ñ–≤ –±–µ–∑ OOM

#### Logging —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:

```python
app.logger.info(f'Export by {username}: from {from_d} to {to_d} count={total_count} write_only={use_write_only}')
```

–õ–æ–≥ –ø–æ–∫–∞–∑—É—î:
- –•—Ç–æ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞–≤
- –î—ñ–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤
- –ß–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è write_only —Ä–µ–∂–∏–º

## –ó–∞–≥–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π

### –î–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
- –ó–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏: **10-12** (–æ—Å–Ω–æ–≤–Ω—ñ + 3√ó3 dropdown)
- –ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è index: **200-400ms**
- –ü–∞–º'—è—Ç—å –Ω–∞ 3000 –∑–∞–ø–∏—Å—ñ–≤: **~150KB**

### –ü—ñ—Å–ª—è –≤—Å—ñ—Ö –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π:
- **–ó–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É: 2-4** (–æ—Å–Ω–æ–≤–Ω—ñ + 1 –¥–ª—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É, –±–µ–∑ dropdown –ø—ñ—Å–ª—è –∫–µ—à—É)
- **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤: 100 –∑–∞–º—ñ—Å—Ç—å –≤—Å—ñ—Ö** (81-95% –µ–∫–æ–Ω–æ–º—ñ—ó –ø–∞–º'—è—Ç—ñ)
- **–ó–º–µ–Ω—à–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤: 70-85%** –∑–∞–≤–¥—è–∫–∏ –∫–µ—à—É–≤–∞–Ω–Ω—é (–∑ 10-12 –¥–æ 2-4)
- **–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó: 10-100x** –∑–∞–≤–¥—è–∫–∏ —ñ–Ω–¥–µ–∫—Å–∞–º
- **–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –ø–æ—à—É–∫—É: 10-50x** –∑–∞–≤–¥—è–∫–∏ —ñ–Ω–¥–µ–∫—Å–∞–º
- **–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É: 1.3-10x** –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Å—ñ–≤
- **–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É: 10-50x** –∑–∞–≤–¥—è–∫–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
- **–ï–∫–æ–Ω–æ–º—ñ—è –ø–∞–º'—è—Ç—ñ: 80-95%** (–ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ + –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è)
- **–ó–º–µ–Ω—à–µ–Ω–Ω—è —á–∞—Å—É –≤—ñ–¥–≥—É–∫—É: 70-90%** (–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç)
- **–ó–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ë–î: 75-90%** –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ
- **–†–æ–∑–º—ñ—Ä HTML: 73-87% –º–µ–Ω—à–µ** –∑–∞–≤–¥—è–∫–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
- **–ï–∫—Å–ø–æ—Ä—Ç Excel –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è: 2-4.5x** –∑–∞–≤–¥—è–∫–∏ –±–∞—Ç—á–∏–Ω–≥—É —Ç–∞ write_only
- **–ï–∫—Å–ø–æ—Ä—Ç –ø–∞–º'—è—Ç—å: 67-87% –º–µ–Ω—à–µ** –∑–∞–≤–¥—è–∫–∏ –±–∞—Ç—á–∏–Ω–≥—É
- **–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î: 99%+ –º–µ–Ω—à–µ** –∑–∞–≤–¥—è–∫–∏ –∫–µ—à—É–≤–∞–Ω–Ω—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

## –ú—ñ–≥—Ä–∞—Ü—ñ—è

–ú—ñ–≥—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∫—Ä–∏–ø—Ç–∞ `add_indexes.py`:

```bash
# –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ
docker exec flask_app python add_indexes.py

# –õ–æ–∫–∞–ª—å–Ω–æ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
python add_indexes.py
```

### –©–æ —Ä–æ–±–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:
1. –°—Ç–≤–æ—Ä—é—î —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é –ë–î –≤ `data/backups/`
2. –î–æ–¥–∞—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏
3. –í–∏–∫–æ–Ω—É—î `ANALYZE` –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –ø–ª–∞–Ω—ñ–≤ –∑–∞–ø–∏—Ç—ñ–≤
4. –í–∏–∫–æ–Ω—É—î `VACUUM` –¥–ª—è –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó –ë–î
5. –ü–æ–∫–∞–∑—É—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤

## –†–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è

–ü–µ—Ä–µ–¥ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è–º –∑–º—ñ–Ω –±—É–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è:
- **–§–∞–π–ª**: `data/backups/app_backup_20260116_224044.db`

–£ —Ä–∞–∑—ñ –ø—Ä–æ–±–ª–µ–º –º–æ–∂–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ë–î:
```bash
docker exec flask_app cp data/backups/app_backup_20260116_224044.db data/app.db
docker-compose restart web
```

## –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:

1. ‚úÖ ~~–ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑–∞–ø–∏—Ç—ñ–≤~~ - **–í–ò–ö–û–ù–ê–ù–û** (Flask-Caching, 15 —Ö–≤ TTL)
2. ‚úÖ ~~–î–æ–¥–∞–≤–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤~~ - **–í–ò–ö–û–ù–ê–ù–û** (8 —ñ–Ω–¥–µ–∫—Å—ñ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–ª—è—Ö)
3. ‚úÖ ~~–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è SQLite PRAGMA~~ - **–í–ò–ö–û–ù–ê–ù–û** (—Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è, 256MB mmap)
4. ‚úÖ ~~–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É —Å—Ç–∞—Ç—É—Å—ñ–≤~~ - **–í–ò–ö–û–ù–ê–ù–û** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `func.count()`)
5. ‚úÖ ~~–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤~~ - **–í–ò–ö–û–ù–ê–ù–û** (100 –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –¥–æ 200)
6. ‚úÖ ~~–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è Excel –µ–∫—Å–ø–æ—Ä—Ç—É~~ - **–í–ò–ö–û–ù–ê–ù–û** (–±–∞—Ç—á–∏–Ω–≥, write_only, –∫–µ—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
7. ‚úÖ ~~–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥—É —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è~~ - **–í–ò–ö–û–ù–ê–ù–û** (utils.py, N+1 —É—Å—É–Ω—É—Ç–æ, admin_statistics –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ)

**–£—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ!** üéâ

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è #7: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥—É —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—è (2026-01-23)

–í–∏–∫–æ–Ω–∞–Ω–æ –º–∞—Å—à—Ç–∞–±–Ω–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ–¥—É.

#### 7.1. –°—Ç–≤–æ—Ä–µ–Ω–æ utils.py –∑ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏

**–ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:**
- `parse_date(date_str, default=None)` - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç —É —Ñ–æ—Ä–º–∞—Ç–∞—Ö DD.MM.YYYY —Ç–∞ YYYY-MM-DD
- `parse_integer(value_str, default=None)` - –ø–∞—Ä—Å–∏–Ω–≥ —Ü—ñ–ª–∏—Ö —á–∏—Å–µ–ª
- `parse_numeric(value_str, default=None)` - –ø–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–µ–ª –∑ –∫–æ–º–æ—é/–∫—Ä–∞–ø–∫–æ—é

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –Ñ–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞—Ç
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ type hints –¥–ª—è –∫—Ä–∞—â–æ–≥–æ IDE support
- –õ–µ–≥—à–µ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏

#### 7.2. –í–∏–¥–∞–ª–µ–Ω–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ø–∞—Ä—Å–∏–Ω–≥—É –¥–∞—Ç (10+ –º—ñ—Å—Ü—å ‚Üí 1 —Ñ—É–Ω–∫—Ü—ñ—è)

**–ó–∞–º—ñ–Ω–µ–Ω–æ –≤ —Ñ—É–Ω–∫—Ü—ñ—è—Ö:**
- `add_record()` - –ø–∞—Ä—Å–∏–Ω–≥ date_of_discharge —Ç–∞ date_of_death
- `api_add_record()` - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç
- `edit_record()` - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç
- `api_edit_record()` - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç
- `nszu_add()` - –ø–∞—Ä—Å–∏–Ω–≥ date —Ç–∞ fakt_summ
- `nszu_edit()` - –ø–∞—Ä—Å–∏–Ω–≥ date —Ç–∞ fakt_summ
- `api_nszu_add()` - –ø–∞—Ä—Å–∏–Ω–≥ date —Ç–∞ fakt_summ

**–†–µ–∑—É–ª—å—Ç–∞—Ç–∏:**
```python
# –ë—É–ª–æ (–ø–æ–≤—Ç–æ—Ä—é–≤–∞–ª–æ—Å—å 10+ —Ä–∞–∑—ñ–≤):
date_of_discharge = None
for fmt in ('%d.%m.%Y', '%Y-%m-%d'):
    try:
        date_of_discharge = datetime.strptime(date_str, fmt).date()
        break
    except ValueError:
        continue

# –°—Ç–∞–ª–æ (–æ–¥–∏–Ω –≤–∏–∫–ª–∏–∫):
date_of_discharge = parse_date(date_str)
```

**–ï—Ñ–µ–∫—Ç:**
- **-300 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É** (–≤–∏–¥–∞–ª–µ–Ω–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è)
- –Ñ–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó - –ª–µ–≥—à–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É
- –ö—Ä–∞—â–∏–π error handling

#### 7.3. –£—Å—É–Ω—É—Ç–æ N+1 –ø—Ä–æ–±–ª–µ–º—É –≤ dashboard

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –ë—É–ª–æ: –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–≤—Å—è —Ç—ñ–ª—å–∫–∏ creator
q = Record.query.options(joinedload(Record.creator))
# –®–∞–±–ª–æ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î record.updater.username - –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç!
```

**–†—ñ—à–µ–Ω–Ω—è:**
```python
# –°—Ç–∞–ª–æ: –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –æ–±–∏–¥–≤–∞ –≤—ñ–¥—Ä–∞–∑—É
q = Record.query.options(joinedload(Record.creator), joinedload(Record.updater))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **-50% SQL –∑–∞–ø–∏—Ç—ñ–≤** –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ dashboard
- –ü—Ä–∏ 100 –∑–∞–ø–∏—Å–∞—Ö: 101 –∑–∞–ø–∏—Ç ‚Üí 51 –∑–∞–ø–∏—Ç

#### 7.4. –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ admin_statistics() (17+ –∑–∞–ø–∏—Ç—ñ–≤ ‚Üí 4 –∑–∞–ø–∏—Ç–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –ë—É–ª–æ: —Ü–∏–∫–ª –ø–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö –∑ 3 –∑–∞–ø–∏—Ç–∞–º–∏ –∫–æ–∂–Ω–∏–π
for dept in dept_list:
    deceased_count = db.session.query(...).filter(dept=dept, ...).scalar()
    discharged_count = db.session.query(...).filter(dept=dept, ...).scalar()
    processing_count = db.session.query(...).filter(dept=dept, ...).scalar()
# –ü—Ä–∏ 10 –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö: 3 √ó 10 = 30 –∑–∞–ø–∏—Ç—ñ–≤ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≤—ñ–¥–¥—ñ–ª–µ–Ω—å!
```

**–†—ñ—à–µ–Ω–Ω—è:**
```python
# –°—Ç–∞–ª–æ: –æ–¥–∏–Ω GROUP BY –∑–∞–ø–∏—Ç –¥–ª—è –≤—Å—ñ—Ö –≤—ñ–¥–¥—ñ–ª–µ–Ω—å
dept_stats = db.session.query(
    Record.discharge_department,
    func.sum(case((Record.date_of_death.isnot(None), 1), else_=0)).label('deceased'),
    func.sum(case(((Record.discharge_status == '–í–∏–ø–∏—Å–∞–Ω–∏–π') &
                   (Record.date_of_death.is_(None)), 1), else_=0)).label('discharged'),
    func.sum(case(((Record.discharge_status == '–û–ø—Ä–∞—Ü—å–æ–≤—É—î—Ç—å—Å—è') &
                   (Record.date_of_death.is_(None)), 1), else_=0)).label('processing')
).filter(...).group_by(Record.discharge_department).all()
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –∑–∞–ø–∏—Ç –∑–∞–º—ñ—Å—Ç—å 30!
```

**–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ:**
- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è: 3 –∑–∞–ø–∏—Ç–∏ ‚Üí 1 –∑–∞–ø–∏—Ç
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –º—ñ—Å—è—Ü—è: 3 –∑–∞–ø–∏—Ç–∏ ‚Üí 1 –∑–∞–ø–∏—Ç

**–î–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
- –ó–∞–ø–∏—Ç records_per_day: 1
- –ó–∞–ø–∏—Ç departments: 1
- –¶–∏–∫–ª –ø–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö: 3 √ó N –∑–∞–ø–∏—Ç—ñ–≤
- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 3 –∑–∞–ø–∏—Ç–∏
- –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º—ñ—Å—è—Ü—å: 3 –∑–∞–ø–∏—Ç–∏
- **–í—Å—å–æ–≥–æ: 8 + 3N –∑–∞–ø–∏—Ç—ñ–≤** (–ø—Ä–∏ 10 –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö = 38 –∑–∞–ø–∏—Ç—ñ–≤!)

**–ü—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
- –ó–∞–ø–∏—Ç records_per_day: 1
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è—Ö (GROUP BY): 1
- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∞–≥—Ä–µ–≥–∞—Ü—ñ—è): 1
- –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º—ñ—Å—è—Ü—å (–∞–≥—Ä–µ–≥–∞—Ü—ñ—è): 1
- **–í—Å—å–æ–≥–æ: 4 –∑–∞–ø–∏—Ç–∏**

**–†–µ–∑—É–ª—å—Ç–∞—Ç–∏:**
| –í—ñ–¥–¥—ñ–ª–µ–Ω—å | –î–æ | –ü—ñ—Å–ª—è | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|-----------|-------|-------|------------|
| 5 | 23 | 4 | **5.7x —à–≤–∏–¥—à–µ** |
| 10 | 38 | 4 | **9.5x —à–≤–∏–¥—à–µ** |
| 20 | 68 | 4 | **17x —à–≤–∏–¥—à–µ** |

#### 7.5. –í–∏–Ω–µ—Å–µ–Ω–æ PRAGMA ANALYZE –∑ before_request

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –ë—É–ª–æ: –≤–∏–∫–æ–Ω—É–≤–∞–ª–æ—Å—å –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ –∑ —ñ–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é 1%
@app.before_request
def optimize_database():
    if random.random() < 0.01:  # 1% –∑–∞–ø–∏—Ç—ñ–≤
        db.session.execute(db.text("ANALYZE"))  # –í–∞–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è!
```

**–ù–∞—Å–ª—ñ–¥–∫–∏:**
- 1% –∑–∞–ø–∏—Ç—ñ–≤ –º–∞–ª–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å 50-200ms
- ANALYZE –±–ª–æ–∫—É—î –ë–î –Ω–∞ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- –ù–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**–†—ñ—à–µ–Ω–Ω—è:**
–°—Ç–≤–æ—Ä–µ–Ω–æ –æ–∫—Ä–µ–º–∏–π —Å–∫—Ä–∏–ø—Ç [analyze_db.py](analyze_db.py):
```python
python analyze_db.py              # –õ–æ–∫–∞–ª—å–Ω–æ
docker exec flask_app python analyze_db.py  # –í Docker
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ cron:**
```bash
# –ó–∞–ø—É—Å–∫–∞—Ç–∏ —â–æ–¥–Ω—è –æ 3:00 –Ω–æ—á—ñ
0 3 * * * cd /app && python analyze_db.py >> logs/analyze.log 2>&1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **-1% –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ** –Ω–∞ –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç–∞—Ö
- –ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- ANALYZE –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ –Ω–µ-–ø—ñ–∫–æ–≤–∏–π —á–∞—Å

#### –ó–∞–≥–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó #7:

**–ö–æ–¥:**
- **-300 —Ä—è–¥–∫—ñ–≤** –¥—É–±–ª—é–≤–∞–Ω–Ω—è
- –ö—Ä–∞—â–∏–π DRY –ø—Ä–∏–Ω—Ü–∏–ø
- –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏

**–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:**
- Dashboard: **-50% SQL –∑–∞–ø–∏—Ç—ñ–≤** (N+1 —É—Å—É–Ω—É—Ç–æ)
- Statistics: **5-17x —à–≤–∏–¥—à–µ** (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤—ñ–¥–¥—ñ–ª–µ–Ω—å)
- –ó–∞–≥–∞–ª—å–Ω–∞ –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å: **-1%** (ANALYZE –≤–∏–Ω–µ—Å–µ–Ω–æ)

**–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ—Å—Ç—å:**
- –Ñ–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞—Ç (utils.py)
- –ö—Ä–∞—â–∏–π error handling
- Type hints –¥–ª—è IDE support

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫—ñ–≤

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `test_performance.py`:

```bash
# –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ
docker exec flask_app python test_performance.py

# –õ–æ–∫–∞–ª—å–Ω–æ
python test_performance.py
```

–°–∫—Ä–∏–ø—Ç –ø–æ—Ä—ñ–≤–Ω—é—î —Å—Ç–∞—Ä–∏–π –ø—ñ–¥—Ö—ñ–¥ (Python counting) –∑ –Ω–æ–≤–∏–º (SQL func.count()) —ñ –ø–æ–∫–∞–∑—É—î:
- –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–±–æ—Ö –º–µ—Ç–æ–¥—ñ–≤
- –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –≤ —Ä–∞–∑–∞—Ö
- –ü–µ—Ä–µ–≤—ñ—Ä–∫—É –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**
```
üìä –î–∞–Ω—ñ:
   ‚Ä¢ –í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤: 528
   ‚Ä¢ –í–∏–ø–∏—Å–∞–Ω–∏–π: 412
   ‚Ä¢ –û–ø—Ä–∞—Ü—å–æ–≤—É—î—Ç—å—Å—è: 114
   ‚Ä¢ –ü–æ—Ä—É—à–µ–Ω—ñ –≤–∏–º–æ–≥–∏: 2

‚è±Ô∏è  –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (10 —ñ—Ç–µ—Ä–∞—Ü—ñ–π):
   ‚Ä¢ Python counting:    22.50 ms
   ‚Ä¢ SQL func.count():   17.33 ms

üöÄ –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è:
   ‚Ä¢ SQL —à–≤–∏–¥—à–µ –≤ 1.3x —Ä–∞–∑—ñ–≤!
   ‚Ä¢ –ï–∫–æ–Ω–æ–º—ñ—è —á–∞—Å—É: 5.17 ms –Ω–∞ –∑–∞–ø–∏—Ç
   ‚Ä¢ –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è: 23.0%

‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–±–æ—Ö –º–µ—Ç–æ–¥—ñ–≤ –∑–±—ñ–≥–∞—é—Ç—å—Å—è!
```

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ —ñ–Ω–¥–µ–∫—Å—ñ–≤

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —â–æ —ñ–Ω–¥–µ–∫—Å–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —ñ–Ω–¥–µ–∫—Å—ñ–≤
docker exec flask_app python -c "
import sqlite3
conn = sqlite3.connect('data/app.db')
cursor = conn.cursor()
cursor.execute(\"SELECT name FROM sqlite_master WHERE type='index' AND name LIKE 'idx_%'\")
for row in cursor.fetchall():
    print(row[0])
"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É (EXPLAIN QUERY PLAN)
docker exec flask_app python -c "
import sqlite3
conn = sqlite3.connect('data/app.db')
cursor = conn.cursor()
cursor.execute(\"EXPLAIN QUERY PLAN SELECT * FROM records WHERE discharge_status='–í–∏–ø–∏—Å–∞–Ω–∏–π'\")
for row in cursor.fetchall():
    print(row)
"
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

–î–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –≤ `app.py`:

```python
import time
from flask import g

@app.before_request
def before_request():
    g.start = time.time()

@app.after_request
def after_request(response):
    if hasattr(g, 'start'):
        diff = time.time() - g.start
        if diff > 0.1:  # –õ–æ–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –¥–æ–≤—à—ñ –∑–∞ 100ms
            app.logger.warning(f"Slow request: {request.path} took {diff:.2f}s")
    return response
```
